<html>

<style>
.ok {
    color:green;
}
.failed {
    color:red;
}
</style>
<script src="framework.js" ></script>
<script src="input_4.js" ></script>
<script>

    class Board{
       constructor(input){
            this.input = input;
            this.marked = [];
        }

        toString(){
            return this.input;
        }

        mark(number){
            this.marked.push(number);
        }

        isMarked(number){
            return this.marked.includes(number);
        }

        getLines(){
            return this.input.split("\n").map(line => line.split(" "));
        }

        getColumns(){
            var matrix = this.getLines();
            return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
        }

        isWinningNumbers(matrix){
            return matrix.map(numbers => numbers.map(number => this.isMarked(number)).every(Boolean)).some(Boolean)
        }

        isWinning(){
            return this.isWinningNumbers(this.getLines()) || this.isWinningNumbers(this.getColumns());
        }

        getUnmarkedNumbers(){
            var result = []
            var all_unmarked = this.getLines().map(numbers => numbers.filter(number => !this.isMarked(number)));
            all_unmarked.forEach(element => {
                result.push(...element.map(Number));
            });
            return result;
        }
        
    }

    function createBoard(input){
        return new Board(input);
    }

    assertObjectsEquals("Simple board", "1 2 3 4", createBoard("1 2 3 4").toString());
    assertObjectsEquals("Number not marked", false, createBoard("1 2 3 4").isMarked("1"));
    var board = createBoard("1 2 3 4");
    board.mark("1");
    assertObjectsEquals("Number marked", true, board.isMarked("1"));

    assertObjectsEquals("Get lines", [["1", "2"], ["3", "4"]], createBoard("1 2\n3 4").getLines());
    assertObjectsEquals("Get columns", [["1", "3"], ["2", "4"]], createBoard("1 2\n3 4").getColumns());

    assertObjectsEquals("Empty board is not winning", false, createBoard("1 2\n3 4").isWinning());

    var board = createBoard("1 2\n3 4");
    board.mark("1");
    assertObjectsEquals("One number marked is not winning", false, board.isWinning());

    var board = createBoard("1 2\n3 4");
    board.mark("1");
    board.mark("2");
    assertObjectsEquals("Line marked IS winning", true, board.isWinning());

    var board = createBoard("1 2\n3 4");
    board.mark("4");
    board.mark("2");
    assertObjectsEquals("Column marked IS winning", true, board.isWinning());

    assertObjectsEquals("Get all unmarked numbers", [1, 3], board.getUnmarkedNumbers());
</script>

</html>