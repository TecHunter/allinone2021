<html>
<style>
.ok {
    color:green;
}
.failed {
    color:red;
}
</style>
<script>
var EOL = "<br/>";


function sysout(...message){
    document.write(...message);
}

function assertEquals(explanation, expected, actual){
    if (expected == actual){
        sysout("<div class='ok'>", explanation, " - OK !</div>");
    }else{
        sysout("<div class='failed'>", explanation, " - FAILED ! Expected :", expected, " != Actual : ", actual, EOL);
        sysout((new Error()).stack);
        sysout("</div>");
    }
}

function assertObjectsEquals(explanation, expected, actual){
    assertEquals(explanation, JSON.stringify(expected), JSON.stringify(actual));
}

function process_move(position, move){
    var [direction, number] = move.split(" ");
    var x = position.x;
    var y = position.y;
    if(direction == "forward"){
        x += +number;
    }
    if(direction == "down"){
        y += +number;
    }
    if(direction == "up"){
        y -= +number;
        if (y < 0) y = 0;
    }
    return {x:x, y:y};
}

assertObjectsEquals("move forward", {x:1, y:0}, process_move({x:0,y:0}, "forward 1"));
assertObjectsEquals("move forward several cells", {x:5, y:0}, process_move({x:0,y:0}, "forward 5"));

assertObjectsEquals("move down several cells", {x:0, y:5}, process_move({x:0,y:0}, "down 5"));

assertObjectsEquals("move up several cells", {x:0, y:1}, process_move({x:0,y:5}, "up 4"));

assertObjectsEquals("move up above sea level", {x:0, y:0}, process_move({x:0,y:5}, "up 10"));

function solve_puzzle(puzzle){
    var moves = puzzle.split("\n");
    var position = {x:0, y:0};
    moves.forEach(move => position = process_move(position, move));
    return position;
}

assertObjectsEquals("solve example puzzle", {x:15, y:10}, solve_puzzle(`forward 5
down 5
forward 8
up 3
down 8
forward 2`));

var puzzle = `forward 2
down 8
down 1
up 7
forward 4
down 4
down 3
forward 2
forward 5
forward 2
forward 7
forward 8
down 7
forward 6
forward 1
down 8
down 8
up 9
down 9
forward 1
up 1
forward 6
forward 7
down 7
forward 4
forward 2
forward 1
forward 3
forward 8
forward 4
up 6
down 2
forward 4
down 3
up 3
up 2
up 3
forward 8
down 5
down 8
down 5
down 4
down 2
up 1
forward 6
forward 6
forward 8
up 5
down 5
forward 8
forward 7
down 9
down 7
down 6
down 3
forward 3
up 7
forward 2
up 6
forward 7
forward 9
down 9
forward 3
down 2
down 2
down 7
down 7
forward 8
down 7
forward 9
up 7
down 4
down 8
forward 2
forward 2
up 1
forward 8
down 5
forward 8
forward 4
up 1
forward 2
forward 2
forward 2
down 9
down 7
down 9
forward 9
forward 4
up 7
down 4
forward 9
forward 8
up 5
up 1
down 1
down 9
down 6
up 8
forward 2
forward 7
up 7
forward 7
forward 6
down 6
forward 8
up 6
forward 7
down 7
forward 4
forward 9
up 9
up 8
forward 8
forward 3
up 1
up 4
down 4
up 9
up 8
forward 6
down 2
down 2
up 4
forward 4
forward 1
down 8
forward 6
down 5
forward 6
down 8
up 1
forward 1
up 9
down 8
up 3
up 9
forward 9
forward 2
down 2
up 6
up 6
forward 8
up 3
down 3
forward 5
up 2
forward 1
forward 1
forward 8
down 4
forward 8
forward 7
down 8
forward 7
down 7
down 2
down 1
down 7
up 9
down 5
up 1
forward 7
down 5
down 9
down 2
down 8
down 4
forward 2
forward 2
forward 1
down 6
up 7
forward 2
down 1
down 5
forward 3
forward 8
down 4
up 2
up 9
up 7
forward 7
forward 4
up 8
up 3
up 4
forward 6
down 7
forward 7
up 6
down 9
up 6
forward 4
up 3
down 3
up 6
down 9
down 6
forward 7
forward 9
forward 2
down 6
up 3
up 9
forward 9
forward 8
up 4
up 5
forward 6
down 5
up 4
up 9
down 8
forward 5
up 5
forward 7
forward 6
down 8
down 5
down 2
up 5
down 8
forward 7
forward 7
up 6
forward 3
down 8
forward 5
forward 8
down 7
forward 6
down 2
forward 2
forward 8
down 4
forward 5
forward 7
forward 5
forward 8
forward 9
forward 6
down 6
up 7
down 9
forward 7
forward 1
up 2
forward 8
down 1
up 9
forward 7
down 2
up 2
forward 5
down 4
down 3
up 8
up 6
forward 3
up 4
forward 3
forward 1
forward 1
up 9
down 2
down 9
up 4
forward 4
forward 4
forward 2
forward 5
forward 9
forward 7
up 4
up 5
down 5
forward 9
down 1
forward 2
down 6
forward 9
down 4
down 2
forward 2
up 7
forward 7
forward 8
up 9
forward 3
up 1
down 5
forward 5
down 1
up 5
forward 4
forward 5
up 3
down 4
up 6
up 1
down 2
forward 6
down 8
up 9
down 7
forward 9
down 8
forward 3
forward 8
down 1
down 7
forward 6
up 6
down 1
down 5
forward 6
down 7
down 2
forward 6
forward 2
forward 8
forward 7
forward 2
down 7
up 2
down 7
forward 8
forward 8
forward 2
forward 4
down 1
down 6
down 1
down 4
down 4
down 2
down 7
up 5
up 5
down 1
forward 3
up 1
down 3
forward 9
forward 4
forward 7
down 4
down 4
down 2
forward 2
forward 1
forward 9
down 1
down 4
down 1
forward 4
up 8
forward 3
down 6
forward 5
forward 9
forward 1
up 8
down 7
down 8
forward 4
down 4
up 5
down 3
forward 3
down 6
down 1
down 9
forward 8
up 5
down 7
up 7
forward 3
up 5
up 7
down 4
up 2
down 2
down 8
up 6
down 4
up 1
down 8
down 4
forward 7
down 4
up 3
down 9
forward 3
up 4
up 1
up 5
down 4
forward 4
forward 4
down 2
down 3
down 4
forward 2
down 9
down 9
down 6
forward 5
forward 7
down 3
forward 2
up 8
down 6
down 8
down 2
up 9
down 1
forward 8
forward 1
forward 8
up 4
up 1
down 8
up 2
forward 5
down 3
forward 5
forward 4
forward 1
down 9
forward 2
forward 5
forward 4
forward 3
down 7
up 9
forward 7
up 8
forward 3
forward 3
down 5
forward 7
forward 5
down 4
forward 6
down 6
up 3
down 3
forward 7
forward 8
up 3
up 8
forward 8
up 4
forward 5
up 4
down 7
forward 4
down 8
down 6
forward 7
down 4
up 7
down 6
up 5
down 2
forward 7
down 7
up 3
up 3
down 3
down 5
forward 3
forward 5
forward 8
down 3
down 8
forward 3
down 1
forward 4
up 5
forward 8
up 1
up 4
down 4
forward 1
forward 6
up 7
up 1
up 7
down 5
forward 8
down 1
forward 1
forward 6
up 9
up 6
down 4
forward 5
down 1
forward 7
down 8
up 3
down 9
down 1
up 7
up 6
forward 8
down 9
down 4
forward 4
up 7
down 3
forward 5
forward 8
up 5
down 7
up 2
forward 3
forward 3
forward 4
down 1
forward 5
forward 7
up 7
forward 7
forward 1
forward 3
forward 9
down 3
forward 5
down 9
down 7
down 4
down 8
up 3
down 1
up 5
down 5
forward 2
down 6
down 5
forward 2
forward 6
down 6
up 6
down 8
up 1
forward 4
forward 2
forward 1
up 1
forward 5
forward 3
forward 7
down 9
forward 3
down 9
up 5
down 7
down 2
down 3
up 5
up 3
down 2
forward 4
forward 1
down 3
up 4
down 8
down 1
forward 6
down 3
forward 9
down 7
down 3
down 4
down 5
up 1
forward 8
forward 2
up 3
up 7
up 1
forward 3
forward 9
up 5
forward 6
down 8
down 9
down 5
forward 6
forward 3
forward 8
forward 7
forward 9
forward 2
up 9
forward 8
down 2
down 6
down 9
down 5
forward 1
down 7
forward 2
down 4
down 1
up 1
down 2
forward 5
forward 8
down 9
up 6
forward 8
forward 3
up 6
up 2
forward 8
down 8
up 1
down 6
down 2
down 6
forward 5
forward 6
down 4
forward 1
down 4
up 7
forward 4
up 1
forward 9
forward 7
up 3
down 7
down 4
forward 3
forward 8
forward 6
forward 6
up 1
up 2
up 8
down 7
forward 8
down 5
forward 6
down 1
down 9
down 2
forward 6
up 3
down 5
down 6
forward 1
forward 2
down 3
forward 8
forward 1
up 5
down 8
down 4
up 9
up 2
forward 7
forward 9
up 8
up 6
forward 1
down 7
up 1
down 3
forward 2
forward 3
down 3
down 2
forward 3
down 7
forward 3
forward 7
forward 7
down 8
down 4
forward 3
forward 4
down 7
down 9
down 4
down 2
forward 7
up 8
down 4
down 3
forward 9
down 5
up 6
up 2
down 5
down 6
forward 2
forward 8
down 1
forward 6
up 7
down 6
forward 4
down 2
down 5
down 9
forward 7
up 4
forward 9
up 7
down 4
down 6
up 9
forward 1
up 7
down 5
forward 3
forward 3
down 7
down 1
down 7
down 7
down 1
forward 8
forward 9
forward 8
down 9
down 8
down 5
down 3
forward 4
forward 1
down 1
forward 1
down 7
forward 7
forward 3
down 8
forward 3
forward 9
forward 8
down 7
forward 8
down 2
up 5
forward 7
forward 4
down 2
up 6
up 8
forward 7
down 9
up 3
forward 4
up 9
up 5
up 5
up 6
down 4
down 5
up 5
forward 7
forward 6
down 4
forward 5
forward 4
up 7
forward 8
down 2
forward 1
down 9
down 8
forward 7
down 7
down 1
forward 9
down 7
forward 6
down 2
up 9
forward 1
up 9
down 3
up 9
down 1
forward 1
down 1
up 6
down 8
up 2
down 3
forward 1
down 4
up 5
down 5
down 4
forward 5
forward 4
down 9
up 7
down 7
forward 7
forward 6
forward 8
down 8
forward 8
down 1
down 1
down 8
down 2
up 2
up 1
forward 5
down 1
up 5
up 2
down 6
up 8
forward 5
down 8
down 1
up 5
down 1
forward 4
down 6
down 4
forward 2
forward 2
down 1
up 4
up 8
down 6
down 2
forward 5
forward 8
forward 7
down 5
down 7
down 3
forward 6
down 3
down 3
forward 6
forward 6
forward 6
up 7
forward 1
down 5
down 2
up 8
forward 6
down 7
down 6
forward 1
up 5
down 4
up 9
forward 3
up 3
forward 9
forward 9
forward 7
forward 5
down 9
forward 1
forward 6
up 8
down 7
forward 9
forward 5
up 4
down 8
forward 8
forward 4
down 9
up 2
forward 5
forward 8
down 8
down 9
down 9
forward 4
forward 8
down 5
down 5
forward 5
forward 5
up 9
up 7
forward 3
up 4
down 8
up 6
up 6
down 4
down 3
forward 2
forward 9
down 4
down 2
forward 4
up 9
forward 1
down 8
down 9
down 9
down 3
forward 1
down 5
up 9
forward 6
up 4
forward 2
forward 2
forward 4
down 9
up 5
up 1
down 6
forward 7
down 8
forward 4
forward 9
up 9
up 4
down 5
down 3
forward 2
down 8
down 6
forward 3
down 2
forward 6
up 2
forward 6
down 7
up 4
forward 1
forward 4
up 4
forward 6
forward 8
down 7
down 6
up 7
down 2
down 4
down 5
forward 1
up 4
forward 8
forward 6
down 8
up 5
up 2
up 9
up 5
forward 6
down 4
up 3
down 8
down 6
down 2
up 3
up 5
down 1
forward 9
up 8
up 2
down 3
forward 6
down 1
forward 5
down 3
up 1
up 2
down 5
down 7
forward 8
down 8
up 9
forward 3
down 8
down 8
forward 1
down 4
down 4
forward 3
up 6
down 3
down 7
down 7
up 1
forward 3
forward 2`;

var solution = solve_puzzle(puzzle);

sysout("Final location : ", JSON.stringify(solution), EOL);
sysout("Solution : ", solution.x * solution.y, EOL);


function process_aim_move(position, move){
    var [direction, number] = move.split(" ");
    var x = position.x;
    var y = position.y;
    var aim = position.aim;
    if(direction == "forward"){
        x += +number;
        y += aim * +number;
        if (y < 0) y = 0;
    }
    if(direction == "down"){
        aim += +number
    }
    if(direction == "up"){
        aim -= +number
    }
    return {x:x, y:y, aim:aim};
}


assertObjectsEquals("move aim up ", {x:0, y:0, aim:-4}, process_aim_move({x:0,y:0, aim:0}, "up 4"));
assertObjectsEquals("move aim down ", {x:0, y:0, aim:4}, process_aim_move({x:0,y:0, aim:0}, "down 4"));

assertObjectsEquals("move aim forward ", {x:4, y:16, aim:4}, process_aim_move({x:0,y:0, aim:4}, "forward 4"));
assertObjectsEquals("move aim forward above sea level", {x:4, y:0, aim:-4}, process_aim_move({x:0,y:0, aim:-4}, "forward 4"));

function solve_aim_puzzle(puzzle){
    var moves = puzzle.split("\n");
    var position = {x:0, y:0, aim:0};
    moves.forEach(move => position = process_aim_move(position, move));
    return position;
}

assertObjectsEquals("solve example puzzle - aim", {x:15, y:60, aim:10}, solve_aim_puzzle(`forward 5
down 5
forward 8
up 3
down 8
forward 2`));

var solution = solve_aim_puzzle(puzzle);
sysout("Final aim location : ", JSON.stringify(solution), EOL);
sysout("Aim solution : ", solution.x * solution.y, EOL);

</script>

</html>
